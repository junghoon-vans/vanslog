---
title: "Jibê³¼ GitHub Actionsë¥¼ ì‚¬ìš©í•œ ECS ë°°í¬ ìë™í™”"
date: 2023-03-24T01:01:51+09:00
draft: false
categories:
  - DevOps
tags:
  - Jib
  - GitHub Actions
  - Amazon ECR
  - Amazon ECS
summary: >
  ê°œë°œì— ì§‘ì¤‘í•˜ê¸° ìœ„í•œ ë°°í¬ íŒŒì´í”„ë¼ì¸ êµ¬ì¶•
---

## ê°œìš”

ìŠ¤í”„ë§ ë¶€íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë°°í¬í•˜ëŠ” ë°©ë²•ì—ëŠ” í¬ê²Œ ë‘ ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤.

- `JAR` íŒŒì¼ì„ ë¹Œë“œí•˜ì—¬ `Amazon EC2`ì— ë°°í¬
- `ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€`ë¥¼ ë¹Œë“œí•˜ì—¬ `Amazon ECS`ì— ë°°í¬

ë‘ ê°€ì§€ ë°©ì‹ì˜ ì°¨ì´ëŠ” ë¹Œë“œ `ê²°ê³¼ë¬¼ì˜ í˜•ì‹`ì— ìˆìœ¼ë©°, ì´ëŸ¬í•œ ê²°ê³¼ë¬¼ì— ë”°ë¼ `ë°°í¬ë˜ëŠ” í™˜ê²½`ì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤. ì¸í„°ë„·ì— ë‚˜ì™€ ìˆëŠ” ë§ì€ ë ˆí¼ëŸ°ìŠ¤ë¥¼ ë³´ë©´ ëŒ€ê°œ `JAR` íŒŒì¼ì„ ë¹Œë“œí•˜ì—¬ `Amazon EC2`ì— ë°°í¬í•˜ëŠ” ë°©ë²•ì„ ì†Œê°œí•˜ê³  ìˆìŠµë‹ˆë‹¤. 

í•˜ì§€ë§Œ ì´ëŸ¬í•œ ë°©ë²•ë³´ë‹¤ëŠ” `Amazon ECS`ì— ë°°í¬í•˜ëŠ” ë°©ë²•ì´ í”„ë¡œì íŠ¸ë¥¼ ê´€ë¦¬í•˜ëŠ” ë° ìˆì–´ì„œ ë”ìš± íš¨ê³¼ì ì…ë‹ˆë‹¤. PaaS ì„œë¹„ìŠ¤ì¸ `Amazon ECS`ë¥¼ ì‚¬ìš©í•˜ë©´ ìì²´ì ìœ¼ë¡œ ì„œë²„ë¥¼ ê´€ë¦¬í•´ì£¼ê¸° ë•Œë¬¸ì— ì„œë²„ ê´€ë¦¬ì— ëŒ€í•œ ë¶€ë‹´ì´ ì¤„ì–´ë“¤ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

ê·¸ë˜ì„œ ì €ëŠ” ìµœê·¼ì— DNDì—ì„œ ì§„í–‰í•œ ì›¨ë”©ë§µ í”„ë¡œì íŠ¸ë¥¼ `Amazon ECS`ì— ë°°í¬í•˜ì˜€ê³  `Jib`ê³¼ `GitHub Actions`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°°í¬ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì¶•í•˜ì˜€ìŠµë‹ˆë‹¤. ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” ì œê°€ êµ¬ì¶•í•œ `Amazon ECS` ë°°í¬ ìë™í™” ë°©ì‹ì— ëŒ€í•´ ì†Œê°œí•´ë“œë¦¬ê³ ì í•©ë‹ˆë‹¤.

## ë°°í¬ ìë™í™” êµ¬ì¶•

### Overview

`Amazon ECS` ë°°í¬ ìë™í™” êµ¬ì¶•ì„ ë³¸ê²©ì ìœ¼ë¡œ ì‹œì‘í•˜ê¸°ì— ì•ì„œ, ë°°í¬ ê³¼ì •ì„ ë‹¨ê³„ë³„ë¡œ ì •ë¦¬í•´ë³´ê² ìŠµë‹ˆë‹¤.

```mermaid
flowchart LR
  a1[GitHub Actions] --> a2[Jib] --> |Build Container Image| a3[Amazon ECR]
  a1 --> a4[Task Definition]
  a4 --> |Deploy to ECS| a5[Amazon ECS]
  a4 --> |Container Image| a3
```

1. `GitHub Actions`ì—ì„œ `Jib`ì„ ì‚¬ìš©í•˜ì—¬ `ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€`ë¥¼ ë¹Œë“œí•œë‹¤.
2. ë¹Œë“œëœ ì´ë¯¸ì§€ë¥¼ `Amazon ECR`ì— í‘¸ì‹œí•œë‹¤.
3. `Task Definition`ì— ì •ì˜ëœ `ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€`ë¥¼ `Amazon ECS`ì— ë°°í¬í•œë‹¤.

> ìœ„ ë‹¨ê³„ë¥¼ ë³´ê³  ì´í•´ê°€ ë˜ì§€ ì•ŠëŠ” ë¶€ë¶„ì´ ìˆë”ë¼ë„ ê±±ì •í•˜ì§€ ì•Šìœ¼ì…”ë„ ì¢‹ìŠµë‹ˆë‹¤. ì•„ë˜ì—ì„œ ê° ë‹¨ê³„ì— ëŒ€í•´ ìì„¸íˆ ì•Œì•„ë³¼ ì˜ˆì •ì…ë‹ˆë‹¤.

### Amazon ECR

> ì´ë¯¸ `Amazon ECR`ì„ ì‚¬ìš©í•˜ì—¬ `ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€`ë¥¼ ê´€ë¦¬í•˜ê³  ìˆë‹¤ë©´ [ë‹¤ìŒ ì±•í„°](#jib)ë¡œ ë„˜ì–´ê°€ì…”ë„ ì¢‹ìŠµë‹ˆë‹¤.

`Amazon ECS`ì— ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë°°í¬í•˜ê¸° ìœ„í•´ì„œëŠ” ìš°ì„  `ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€`ë¥¼ ì¤€ë¹„í•´ë‘ì–´ì•¼ í•©ë‹ˆë‹¤.
ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ëŠ” `Docker Hub`ë‚˜ `Amazon ECR`ì™€ ê°™ì€ `ì»¨í…Œì´ë„ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬` ì„œë¹„ìŠ¤ë¥¼ í™œìš©í•˜ì—¬ ê´€ë¦¬í•©ë‹ˆë‹¤. ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” `Amazon ECR`ì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ê¸°ì¤€ìœ¼ë¡œ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.

> ğŸ’¡ `Docker Hub`ì™€ `Amazon ECR`ì˜ ì°¨ì´ëŠ” `Docker Hub`ëŠ” `ê³µê°œ ë ˆí¬ì§€í† ë¦¬`ë¥¼ ì œê³µí•˜ê³  `Amazon ECR`ì€ `ë¹„ê³µê°œ ë ˆí¬ì§€í† ë¦¬`ë¥¼ ì œê³µí•œë‹¤ëŠ” ì ì…ë‹ˆë‹¤. ì„œë¹„ìŠ¤ì˜ ê³µê°œë¥¼ ì›ì¹˜ ì•ŠëŠ”ë‹¤ë©´ `Amazon ECR`ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ì€ ì„ íƒì…ë‹ˆë‹¤.

#### ë ˆí¬ì§€í† ë¦¬ ìƒì„±

ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•´ì„œëŠ” ë ˆí¬ì§€í† ë¦¬ë¥¼ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤. `Amazon ECR` ì½˜ì†”ì— ì ‘ì†í•˜ì—¬ `ë¦¬í¬ì§€í† ë¦¬ ìƒì„±` ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ í™”ë©´ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.

![ECR ë¦¬í¬ì§€í† ë¦¬ ìƒì„±](https://user-images.githubusercontent.com/44942700/227782802-16a5fdb0-43a0-4ac7-a273-4246e88c3fba.png)

ë ˆí¬ì§€í† ë¦¬ ì´ë¦„ì„ ì…ë ¥í•˜ê³  í•˜ë‹¨ì˜ `ë¦¬í¬ì§€í† ë¦¬ ìƒì„±` ë²„íŠ¼ì„ í•œ ë²ˆ ë” í´ë¦­í•©ë‹ˆë‹¤.

![ECR ë¦¬í¬ì§€í† ë¦¬ URI](https://user-images.githubusercontent.com/44942700/227783017-d28abeb8-dbfd-438a-a92b-02e0be77340b.png)

ì´ë ‡ê²Œ ë¦¬í¬ì§€í† ë¦¬ë¥¼ ìƒì„±í•˜ë©´ ìœ„ì™€ ê°™ì´ URIê°€ ìƒì„±ë©ë‹ˆë‹¤.
ì´ëŸ¬í•œ URIëŠ” `ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€`ë¥¼ ë¹Œë“œí•˜ê³  ì—…ë¡œë“œí•˜ëŠ”ë° ì‚¬ìš©ë©ë‹ˆë‹¤.
ë°”ë¡œ ë‹¤ìŒ ì±•í„°ì—ì„œ ì‚¬ìš©ë  ê²ƒì´ë¯€ë¡œ ë³µì‚¬í•´ë‘ì‹œê¸° ë°”ëë‹ˆë‹¤.

>ğŸ’¡ ë ˆí¬ì§€í† ë¦¬ì˜ ì´ë¦„ì€ `ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€`ì˜ ì´ë¦„ê³¼ ë™ì¼í•˜ê²Œ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤. ë„ì»¤ í—ˆë¸Œì—ì„œ ì´ë¯¸ì§€ë¥¼ ë°›ì•„ì˜¬ ë•Œ ì§€ì •í•˜ëŠ” ì´ë¦„ì´ ì´ê²ƒê³¼ ë™ì¼í•œ ê°œë…ì…ë‹ˆë‹¤.

### Jib

[Jib](https://cloud.google.com/java/getting-started/jib?hl=ko)ì€ `Google`ì—ì„œ ì œê³µí•˜ëŠ” `Java`ìš© `Docker` ì´ë¯¸ì§€ ë¹Œë”ì…ë‹ˆë‹¤. `Jib`ì„ ì‚¬ìš©í•˜ë©´ `Dockerfile`ì„ ì‘ì„±í•˜ì§€ ì•Šì•„ë„ `ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€`ë¥¼ ë¹Œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![Docker ë¹Œë“œ](https://cloud.google.com/java/images/docker_build_flow.png?hl=ko)

Dockerë¥¼ ì‚¬ìš©í•˜ì—¬ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ëŠ” ê²½ìš° ìœ„ì™€ ê°™ì€ ê³¼ì •ì„ ê±°ì¹©ë‹ˆë‹¤. Dockerfileì„ ì‘ì„±í•´ì•¼ í•˜ëŠ” ë²ˆê±°ë¡œì›€ê³¼ ì—¬ëŸ¬ ë‹¨ê³„ì˜ ë¹Œë“œ ê³¼ì •ì„ ê±°ì³ì•¼ í•œë‹¤ëŠ” ë‹¨ì ì´ ìˆìŠµë‹ˆë‹¤.

![Jib ë¹Œë“œ](https://cloud.google.com/java/images/jib_build_flow.png?hl=ko)

ë°˜ë©´ `Jib`ì„ ì‚¬ìš©í•˜ë©´ ìœ„ì™€ ê°™ì€ ê³¼ì •ì„ ê±°ì¹˜ì§€ ì•Šê³  `ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€`ë¥¼ ë¹Œë“œí•  ìˆ˜ ìˆìœ¼ë©°, ë°”ë¡œ ì»¨í…Œì´ë„ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— í‘¸ì‹œí•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

#### Gradle Plugin ì„¤ì •

`Jib`ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” `Gradle` ë˜ëŠ” `Maven`ì˜ í”ŒëŸ¬ê·¸ì¸ì„ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤. ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” `Gradle`ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê¸°ì¤€ìœ¼ë¡œ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.

1. í”ŒëŸ¬ê·¸ì¸ ì¶”ê°€

`Jib` í”ŒëŸ¬ê·¸ì¸ì„ `build.gradle`ì— ì¶”ê°€í•©ë‹ˆë‹¤.

```groovy
plugins {
  id 'com.google.cloud.tools.jib' version '3.1.4'
}
```

2. Jib ì„¤ì •
   
```groovy
jib {
    from {
        image = 'eclipse-temurin:17-jdk-alpine'
    }
    to {
        image = '<aws_account_id>.dkr.ecr.<region>.amazonaws.com/<repository_name>'
        tags = ['latest', "${project.version}".toString()]
        credHelper = 'ecr-login' 
    }
    container {
        creationTime = 'USE_CURRENT_TIMESTAMP'
        jvmFlags = ['-Dspring.profiles.active=prod', '-XX:+UseContainerSupport', '-Dserver.port=8080', '-Dfile.encoding=UTF-8']
        ports = ['8080']
        user = 'nobody:nogroup'
    }
}
```

í•´ë‹¹ ì„¤ì •ì—ì„œ ê°€ì¥ ì¤‘ìš”í•˜ê²Œ ë³¼ ë¶€ë¶„ì€ `to` ì„¤ì •ì˜ `image`ì…ë‹ˆë‹¤.
ì´ì „ ëª©ì°¨ì—ì„œ `Amazon ECR`ì— ë ˆí¬ì§€í† ë¦¬ë¥¼ ìƒì„±í–ˆë‹¤ë©´, `image`ì— `Amazon ECR` ë ˆí¬ì§€í† ë¦¬ì˜ URIë¥¼ `image`ì— ë¶™ì—¬ë„£ì–´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.

> ë¡œì»¬ì—ì„œ ì§ì ‘ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— í‘¸ì‹œí•˜ê¸° ìœ„í•´ì„œëŠ” `credHelper` ì„¤ì •ê³¼ `ì¸ì¦ íˆ´`ì„ ì„¤ì¹˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.
> ì´ì™€ ê´€ë ¨ëœ ìì„¸í•œ ì„¤ì • ë‚´ìš©ì€ [Jib ê³µì‹ ë¬¸ì„œ](https://github.com/GoogleContainerTools/jib/tree/master/jib-gradle-plugin#configuration)ë¥¼ í†µí•´ í™•ì¸í•´ì£¼ì„¸ìš”.
> ëª¨ë“  ì„¤ì •ì´ ì™„ë£Œí–ˆë‹¤ë©´ `./gradlew jib` ëª…ë ¹ì–´ë¡œ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ê³  ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— í‘¸ì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Amazon ECS

> ì´ë¯¸ `Amazon ECS` ê¸°ë°˜ìœ¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìš´ì˜ì¤‘ì´ë¼ë©´ [ë‹¤ìŒ ì±•í„°](#github-actions)ë¡œ ë„˜ì–´ê°€ì…”ë„ ì¢‹ìŠµë‹ˆë‹¤.

`Amazon ECS`ë¥¼ ë°°í¬í•˜ê¸° ìœ„í•´ì„œëŠ” ëª‡ ê°€ì§€ ê°œë…ì— ëŒ€í•´ ì¡ê³  ê°€ëŠ” ê²ƒì„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.
íŠ¹íˆ `í´ëŸ¬ìŠ¤í„°`, `ì„œë¹„ìŠ¤`, `íƒœìŠ¤í¬ ì •ì˜`ì— ëŒ€í•´ì„œëŠ” ê°„ëµí•˜ê²Œë¼ë„ ì´í•´í•˜ê³  ë„˜ì–´ê°€ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.
ì €ëŠ” ì²˜ìŒì— ì´ëŸ¬í•œ ê°œë…ì„ ì´í•´í•˜ì§€ ì•Šì€ ì±„ë¡œ `Amazon ECS` ë°°í¬ë¥¼ ì§„í–‰í•˜ëŠ” ê³¼ì •ì—ì„œ ë˜ë ¤ ë§ì€ ì‹œê°„ì„ ë‚­ë¹„í–ˆëŠ”ë°, ì´ ê¸€ì„ ë³´ì‹œëŠ” ì—¬ëŸ¬ë¶„ì€ ê·¸ëŸ¬ì§€ ì•Šê¸°ë¥¼ ë°”ëë‹ˆë‹¤.

#### í´ëŸ¬ìŠ¤í„°

`í´ëŸ¬ìŠ¤í„°`ëŠ” `Amazon ECS`ì—ì„œ ì»¨í…Œì´ë„ˆë¥¼ ê´€ë¦¬í•˜ëŠ” ë‹¨ìœ„ì…ë‹ˆë‹¤.
`Amazon ECS ì½˜ì†” > í´ëŸ¬ìŠ¤í„° íƒ­ > í´ëŸ¬ìŠ¤í„° ìƒì„±`ì—ì„œ íƒœìŠ¤í¬ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![ECS í´ëŸ¬ìŠ¤í„° ìƒì„±](https://user-images.githubusercontent.com/44942700/227784533-1032080d-410c-4363-9517-76c6a8571cbc.png)

í´ëŸ¬ìŠ¤í„° ìƒì„± ê³¼ì •ì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ ë¶€ë¶„ì€ `ì¸í”„ë¼ ì„¤ì •`ì…ë‹ˆë‹¤.
`Amazon ECS`ì—ëŠ” `EC2`ì™€ `Fargate` ë‘ ê°€ì§€ ë°©ì‹ìœ¼ë¡œ í´ëŸ¬ìŠ¤í„°ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
`Fargate`ëŠ” ì„œë²„ë¦¬ìŠ¤ ì»¨í…Œì´ë„ˆ ê´€ë¦¬ ì„œë¹„ìŠ¤ë¡œ, EC2ë³´ë‹¤ ì‚¬ì–‘ ëŒ€ë¹„ ë¹„ìš©ì´ ì €ë ´í•˜ì§€ëŠ” ì•Šì§€ë§Œ ì‹œê°„ ë‹¨ìœ„ë¡œ ë¹„ìš©ì„ ì§€ë¶ˆí•˜ë¯€ë¡œ ë”ìš± ìœ ì—°í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ìƒí™©ì— ë”°ë¼ ê²°ì •í•˜ì‹œë©´ ë˜ì§€ë§Œ í”„ë¦¬í‹°ì–´ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ `EC2`ë¥¼ ì„ íƒí–ˆìŠµë‹ˆë‹¤.
ìš´ì˜ì²´ì œë¡œëŠ” `Amazone Liuux 2`ë¥¼ ì„ íƒí•˜ê³  `ì¸ìŠ¤í„´ìŠ¤ ìœ í˜•`ì€ `t2.micro`ë¥¼ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.

#### íƒœìŠ¤í¬ ì •ì˜

`íƒœìŠ¤í¬ ì •ì˜`ëŠ” `Amazon ECS`ì—ì„œ ì»¨í…Œì´ë„ˆ ì‹¤í–‰ì— í•„ìš”í•œ ì´ë¯¸ì§€ë‚˜ ì‚¬ì–‘ ë“±ì„ ì •ì˜í•˜ëŠ” ë‹¨ìœ„ì…ë‹ˆë‹¤.
`Amazon ECS ì½˜ì†” > íƒœìŠ¤í¬ ì •ì˜ íƒ­ > ìƒˆ íƒœìŠ¤í¬ ì •ì˜ ìƒì„±`ì—ì„œ íƒœìŠ¤í¬ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![ECS íƒœìŠ¤í¬ ì •ì˜ ìƒì„±](https://user-images.githubusercontent.com/44942700/227782600-a845dbc0-2bb2-42c6-b2ac-a9718915cb1c.png)

ì´ë•Œ `ìƒˆ íƒœìŠ¤í¬ ì •ì˜ ìƒì„±`ê³¼ `JSONì„ ì‚¬ìš©í•˜ì—¬ ìƒˆ íƒœìŠ¤í¬ ì •ì˜ ìƒì„±` ë‘ ê°€ì§€ ë°©ë²• ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•  ìˆ˜ ìˆëŠ”ë°, ê°„í¸í•˜ê²Œ ì§„í–‰í•˜ê¸° ìœ„í•´ì„œëŠ” `ìƒˆ íƒœìŠ¤í¬ ì •ì˜ ìƒì„±`ì„ ì„ íƒí•˜ì‹œë©´ ë©ë‹ˆë‹¤.

![ECS íƒœìŠ¤í¬ ì •ì˜ ì„¤ì •](https://user-images.githubusercontent.com/44942700/227792521-278b030a-b4ba-44ab-8740-01b31e800b4b.png)

`íƒœìŠ¤í¬ ì •ì˜ íŒ¨ë°€ë¦¬`ì—ëŠ” ìƒˆë¡œ ìƒì„±í•  íƒœìŠ¤í¬ ì •ì˜ ì´ë¦„ì„ ì…ë ¥í•˜ê³ , ì•„ë˜ ì»¨í…Œì´ë„ˆ í•­ëª©ë“¤ì„ ì„¤ì •í•˜ë©´ ë©ë‹ˆë‹¤.
ì»¨í…Œì´ë„ˆì—ì„œ ì¤‘ìš”í•˜ê²Œ ë³¼ ë¶€ë¶„ì€ ì´ë¯¸ì§€ì˜ URIì…ë‹ˆë‹¤. `Jib` ì„¤ì •ì— ì‚¬ìš©í•œ ë ˆí¬ì§€í† ë¦¬ URIë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ë©´ ë˜ë©°, í•„ìš”ì— ë”°ë¼ íƒœê·¸ë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


#### ì„œë¹„ìŠ¤

`ì„œë¹„ìŠ¤`ëŠ” `Amazon ECS`ì—ì„œ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•˜ëŠ” ë‹¨ìœ„ì´ë©° `íƒœìŠ¤í¬ ì •ì˜`ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤.
`Amazon ECS ì½˜ì†” > í´ëŸ¬ìŠ¤í„° íƒ­ > ìƒì„±í•œ í´ëŸ¬ìŠ¤í„° ì„ íƒ > ì„œë¹„ìŠ¤ íƒ­ > ìƒì„±`ì—ì„œ ì„œë¹„ìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![ì„œë¹„ìŠ¤ ìƒì„±](https://user-images.githubusercontent.com/44942700/227902343-c88764ca-3331-40bf-986d-b8a00834ef4c.png)

ì„œë¹„ìŠ¤ ìƒì„± ê³¼ì •ì—ì„œ ì¤‘ìš”í•˜ê²Œ ë³¼ ë¶€ë¶„ì€ `íƒœìŠ¤í¬ ì •ì˜`ë¥¼ ì„¤ì •í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.
ì´ì „ ì±•í„°ì—ì„œ ìƒì„±í•œ `íƒœìŠ¤íŠ¸ ì •ì˜ íŒ¨ë°€ë¦¬`ë¥¼ ì„ íƒí•˜ê³  `ê°œì •`ì„ í´ë¦­í•˜ì—¬ ì›í•˜ëŠ” ë²„ì „ì˜ íƒœìŠ¤í¬ ì •ì˜ë¥¼ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### íƒœìŠ¤í¬ ì •ì˜ íŒŒì¼ ë‚´ë ¤ë°›ê¸°

`Amazon ECS`ì—ì„œ ìƒì„±í•œ íƒœìŠ¤í¬ ì •ì˜ë¥¼ `Github Actions`ì—ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” `JSON` í˜•ì‹ìœ¼ë¡œ ëœ ì„¤ì • íŒŒì¼ì´ í•„ìš”í•©ë‹ˆë‹¤.
`AWS CLI`ë¥¼ ì‚¬ìš©í•˜ë©´ ì‰½ê²Œ íƒœìŠ¤í¬ ì •ì˜ íŒŒì¼ì„ ë‚´ë ¤ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```bash
aws ecs describe-task-definition \
   --task-definition {task-definition-family} \
   --query taskDefinition > task-definition.json
```

í•´ë‹¹ ëª…ë ¹ì–´ë¥¼ í”„ë¡œì íŠ¸ ë£¨íŠ¸ ê²½ë¡œì—ì„œ ì‹¤í–‰í•˜ë©´ `task-definition.json` íŒŒì¼ì´ ìƒì„±ë©ë‹ˆë‹¤.
ì´ë ‡ê²Œ ìƒì„±ëœ íŒŒì¼ì€ `Github Actions`ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ `GitHub` ë ˆí¬ì§€í† ë¦¬ì— ì»¤ë°‹í•´ì£¼ì„¸ìš”.

### GitHub Actions

ì´ ì±•í„°ì—ì„œëŠ” `Github Actions`ë¥¼ í†µí•´ `Amazon ECR`ì— ì´ë¯¸ì§€ë¥¼ í‘¸ì‹œí•˜ê³ , `Amazon ECS`ì— ë°°í¬í•˜ëŠ” íŒŒì´í”„ë¼ì¸ì„ êµ¬ì¶•í•©ë‹ˆë‹¤.
`Jib`, `Amazon ECR`, `Amazon ECS`ì— ëŒ€í•œ ì„¤ì •ì„ ëª¨ë‘ ì™„ë£Œí•˜ì§€ ì•Šì•˜ë‹¤ë©´ ì´ì „ ì±•í„°ë¥¼ ì°¸ê³ í•˜ì—¬ ì™„ë£Œí•´ì£¼ì„¸ìš”.

```yaml
name: CD
on:
  push:
    branches:
      - main
jobs:
  deploy:
    name: Deploy to AWS
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v1
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: <AWS_REGION>
      - name: Login to Amazon ECR
        uses: aws-actions/amazon-ecr-login@v1
      - name: Set up JDK 17
        uses: actions/setup-java@v2
        with:
          java-version: 17
          distribution: 'temurin'
          cache: 'gradle'
      - name: Build and push image to Amazon ECR
        run: ./gradlew clean jib -x test
      - name: Deploy to AWS ECS
        uses: aws-actions/amazon-ecs-deploy-task-definition@v1
        with:
          task-definition: task-definition.json
          cluster: <ECS_CLUSTER_NAME>
          service: <ECS_SERVICE_NAME>
          wait-for-service-stability: true
```

ìœ„ ì½”ë“œëŠ” `Jib`ì„ ì‚¬ìš©í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë¹Œë“œí•˜ê³  `Amazon ECR`ì— ì´ë¯¸ì§€ë¥¼ í‘¸ì‹œí•œ í›„, `Amazon ECS`ì— ë°°í¬í•˜ëŠ” GitHub Actions íŒŒì´í”„ë¼ì¸ì…ë‹ˆë‹¤.
ì´ë•Œ `AWS_ACCESS_KEY_ID`ì™€ `AWS_SECRET_ACCESS_KEY`ì´ `Github Secrets`ì— ë“±ë¡ë˜ì–´ ìˆì–´ì•¼ í•˜ëŠ”ë°, ì´ëŠ” `AWS`ì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ì•¡ì„¸ìŠ¤ í‚¤ì…ë‹ˆë‹¤.

> `AWS IAM ì½˜ì†”`ì—ì„œ `AmazonEC2ContainerRegistryFullAccess`ì™€ `AmazonECS_FullAccess` ê¶Œí•œì„ ë¶€ì—¬í•œ ì‚¬ìš©ìë¥¼ ìƒì„±í•˜ê³ ,
> ì•¡ì„¸ìŠ¤ í‚¤ë¥¼ ë°œê¸‰ë°›ì•„ `Github Secrets`ì— ë“±ë¡í•´ì£¼ì„¸ìš”.

## ê²°ê³¼ í™•ì¸ ë° ì—ëŸ¬ í•´ê²°

![ë°°í¬ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ ê²°ê³¼](https://user-images.githubusercontent.com/44942700/227918540-f6578718-0706-4dc8-ba33-55e9c34ac998.png)

`main` ë¸Œëœì¹˜ì— ì»¤ë°‹ì´ ë°œìƒí•˜ë©´ `Github Actions`ê°€ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë¹Œë“œí•˜ê³  `Amazon ECS`ì— ìƒˆë¡œìš´ ë²„ì „ì„ ë°°í¬í•©ë‹ˆë‹¤.
í•˜ì§€ë§Œ ìœ„ ì´ë¯¸ì§€ì™€ ê°™ì´ Warning ë©”ì‹œì§€ê°€ ë°œìƒí•  ìˆ˜ë„ ìˆëŠ”ë° ì´ëŠ” `task-definition.json` íŒŒì¼ì— ì •ì˜í•˜ì§€ ì•Šì•„ë„ ë˜ëŠ” í•­ëª©ì´ í¬í•¨ë˜ì–´ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
`task-definition.json` íŒŒì¼ì—ì„œ ì´ëŸ¬í•œ í•­ëª©ë“¤ì„ ì œê±°í•´ì£¼ë©´ Warning ë©”ì‹œì§€ë¥¼ ì—†ì•¨ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ë§ˆì¹˜ë©°

ì €ëŠ” ì›¨ë”©ë§µ í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ëŠ” ê³¼ì •ì—ì„œ ìœ„ì™€ ê°™ì€ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì¶•í•˜ì˜€ìŠµë‹ˆë‹¤.
ë•ë¶„ì— ìƒˆë¡œìš´ ê¸°ëŠ¥ì„ í”„ë¡œë•ì…˜ í™˜ê²½ì— ë°°í¬í•˜ëŠ” ê³¼ì •ì„ ê°„ì†Œí™”í•  ìˆ˜ ìˆì—ˆê³ , ì„œë²„ ê´€ë¦¬ì— ëŒ€í•œ ë¶€ë‹´ì„ ëœ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.
ì´ê²ƒì´ ë°”ë¡œ ì €í¬ íŒ€ì´ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œì— ëª°ë‘í•  ìˆ˜ ìˆì—ˆë˜ ë¹„ê²°ì…ë‹ˆë‹¤.

## ì°¸ê³  ë¬¸í—Œ

- [SpringBoot + Gradle jib + Github Actions + ECR + ECS íŒŒì´í”„ë¼ì¸ êµ¬ì¶•í•˜ê¸°](https://kevin-park.medium.com/springboot-gradle-jib-github-actions-ecr-ecs-íŒŒì´í”„ë¼ì¸-êµ¬ì¶•í•˜ê¸°-d09dc46a6958)
